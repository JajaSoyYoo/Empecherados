<!DOCTYPE html>
<html lang="es">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
  <link href="https://fonts.cdnfonts.com/css/nexa-bold?styles=29913" rel="stylesheet">
  <link href="https://fonts.cdnfonts.com/css/handil-pro?styles=162901" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}"/>
  <script src="https://kit.fontawesome.com/deb38cd3d7.js" crossorigin="anonymous"></script>     
  <title>Formulario de Datos Generales</title>
</head>
<body>
  <!-- Barra de navegación -->
  <nav class="navbar navbar-expand-lg navbar-color">
    <div class="container">
      <!-- Logo -->
      <a class="navbar-brand" href="#">
        <img src="{{ url_for('static', filename='css/img/LogoCUT.png') }}" alt="Tu Logo" width="109" height="48" class="d-inline-block align-top logo-with-shadow">
      </a>
    </div>
  </nav>
  <div class="banner">
    <div class="container p-5">
      <div class="card mx-3 mt-n5 shadow-lg circular" style="border-radius: 40px; border: none">
        <div class="card-body p-5">
          <h5 class="pb-2 text-center registro-text">REGISTRO</h5>
          <h5 class="pb-2 text-center datos-generales-text">Datos generales</h5>
          <hr>
          <form>
            <!-- Grupo 1 de campos del formulario -->
            <div class="row">
              <div class="col-md-4">
                <label for="NombreInput">Nombre(s)</label>
                <div class="form-group mb-3">
                  <input type="text" class="form-control circular" id="NombreInput" placeholder="Ingresa tu nombre" required>
                </div>
              </div>
              <div class="col-md-4">
                <label for="apellidopInput">Apellido paterno</label>
                <div class="form-group mb-3">
                  <input type="text" class="form-control circular" id="apellidopInput" placeholder="Ingresa tu apellido paterno" required>
                </div>
              </div>
              <div class="col-md-4">
                <label for="apellidomInput">Apellido materno</label>
                <div class="form-group mb-3">
                  <input type="text" class="form-control circular" id="apellidomInput" placeholder="Ingresa tu apellido materno" required>
                </div>
              </div>
            </div>

            <!-- Grupo 2 de campos del formulario -->
            <div class="row">
              <div class="col-md-4">
                <label for="sexoInput">Sexo</label>
                <div class="form-group mb-3">
                  <select class="form-select circular" id="sexoInput" required>
                    <option disabled selected>Selecciona una opción</option>
                    <option value="Masculino">Masculino</option>
                    <option value="Femenino">Femenino</option>
                    <option value="Otro">Otro</option>
                  </select>
                </div>             
              </div>
              <div class="col-md-4">
                <label for="celInput">Telefono de contacto</label>
                <div class="form-group mb-3">
                  <input type="text" class="form-control circular" id="celInput" placeholder="Ingresa tu Telefono de contacto" required>
                </div>
              </div>
              <div class="col-md-4">
                <label for="correoInput">Correo electronico</label>
                <div class="form-group mb-3">
                  <input type="text" class="form-control circular" id="correoInput" placeholder="Ingresa tu correo" required>
                </div>
              </div>
            </div>

            <!-- Grupo 3 de campos del formulario -->
            <div class="row">
              <div class="col-md-4">
                <label for="codigo_postal">Codigo postal</label>
                <div class="form-group mb-3">
                  <input type="text" name="codigo_postal" class="form-control circular" id="codigo_postal" maxlength="5" minlength="5" placeholder="Ingresa tu codigo postal" required="">
                </div>
              </div>
              <div class="col-md-4">
                <label for="paisInput">Pais</label>
                <div class="form-group mb-3">
                  <input type="text" class="form-control circular" id="paisInput" placeholder="Ingresa tu pais" required>
                </div>
              </div>
              <div class="col-md-4">
                <label for="id_estado">Estado</label>
                <div class="form-group mb-3">
                  <select name="estado" class="form-select circular" id="id_estado" required><option disabled selected value="0" selected="true">Selecciona una opcion...</option><option value="1">Aguascalientes</option><option value="2">Baja California</option><option value="3">Baja California Sur</option><option value="4">Campeche</option><option value="8">Chihuahua</option><option value="7">Chiapas</option><option value="9">Ciudad de México</option><option value="5">Coahuila de Zaragoza</option><option value="6">Colima</option><option value="10">Durango</option><option value="12">Guerrero</option><option value="11">Guanajuato</option><option value="13">Hidalgo</option><option value="14">Jalisco</option><option value="15">Estado de México</option><option value="16">Michoacán de Ocampo</option><option value="17">Morelos</option><option value="18">Nayarit</option><option value="19">Nuevo León</option><option value="20">Oaxaca</option><option value="21">Puebla</option><option value="22">Querétaro</option><option value="23">Quintana Roo</option><option value="25">Sinaloa</option><option value="24">San Luis Potosí</option><option value="26">Sonora</option><option value="27">Tabasco</option><option value="28">Tamaulipas</option><option value="29">Tlaxcala</option><option value="30">Veracruz de Ignacio de la Llave</option><option value="31">Yucatán</option><option value="32">Zacatecas</option></select>
              </div>
            </div>

            <!-- Grupo 4 de campos del formulario -->
            <div class="row">
              <div class="col-md-4">
                <label for="id_municipio">Municipio</label>
                <div class="form-group mb-3">
                  <select name="municipio" class="form-select circular" id="id_municipio" required>
                    <option value="0">Selecciona tu municipio...</option>
                  
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <label for="id_colonia">Colonia</label>
                <div class="form-group mb-3">
                  <select name="colonia" class="form-select circular" id="id_colonia" required>
                    <option value="0">Selecciona tu colonia...</option>
                  
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <label for="nacionalidadInput">Nacionalidad</label>
                <div class="form-group mb-3">
                  <input type="text" class="form-control circular" id="nacionalidadInput" placeholder="Ingresa tu nacionalidad" required>
                </div>
              </div>
            </div>

            <!-- Grupo 5 de campos del formulario -->
            <div class="row">
              <div class="col-md-4">
                <label for="fechanacimientoInput">Fecha de nacimiento</label>
                <div class="form-group mb-3">
                  <input type="date" class="form-control circular" id="fechanacimientoInput" placeholder="Fecha de Nacimiento" required>
                </div>
              </div>
            </div>

            <!-- Botones de navegación -->
            <div class="nav-buttons mt-4 text-center">
              <button type="button" class="btn btn-primary" style="border-radius: 30px; background-color: #0C616E; text-align: center;">Siguiente</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Option 1: Bootstrap Bundle with Popper -->
 
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LE"></script>
  <script type="text/javascript">
    jQuery.noConflict();
    var codigoPostalTmp = "";
    var cveEstadoTmp = 0;

    jQuery(document).ready(function() {
        getEstadosIni();

        jQuery("#codigo_postal").change(getEstadoActual);
        jQuery("#id_estado").change(getMunicipios);
        jQuery("#id_municipio").change(getColonias);

        jQuery("#codigo_postal").keypress(function(e) {
            var code = (e.keyCode ? e.keyCode : e.which);
            if(code==13){
                e.preventDefault();
                jQuery("#codigo_postal").trigger("blur");
            }
        });
    });

    function cerrar_msg_err(){
        jQuery("#divmsgerr").attr("style","visibility:hidden"); 
        jQuery("#codigo_postal").val("");
    }

    function info(){
        var sMsg = '';
        var strIcon = ''; 
        var codigoPostal = jQuery("#codigo_postal").val();
        var estadoId = jQuery("#id_estado").val();
        var municipioId = jQuery("#id_municipio").val();
        var coloniaId = jQuery("#id_colonia").val();
        var estado = jQuery("#id_estado option:selected" ).text();
        var municipio = jQuery("#id_municipio option:selected" ).text();
        var colonia = jQuery("#id_colonia option:selected" ).text();

        if (estadoId && (estadoId > 0)) { 
            if (codigoPostal && (codigoPostal > 0)){
                if (estadoId && (estadoId > 0))
                    sMsg += 'Usted eligió el estado ' + estado ;
                if (municipioId && (municipioId > 0))
                    sMsg += '<br/>Municipio ' + municipio;
                if (coloniaId && (coloniaId > 0))
                    sMsg += '<br/>Colonia ' + colonia;
                if(codigoPostal && (codigoPostal > 0)) 
                    sMsg += '<br/>Código Postal ' + codigoPostal;
                
                    strIcon = 'success';
            } else{
                sMsg = 'Código postal inválido'
                strIcon = 'error';
            }
        } else {
            sMsg = 'No ha seleccionado un estado'
            strIcon = 'error';
        }

        Swal.fire({
            icon: strIcon,
            html: sMsg
        })
    }

    function getEstadosIni() {
        // Eliminamos las opciones anteriores del select
        jQuery("#id_estado").html("");

        var request = jQuery.ajax({
            type: "GET",
            url: "/ajax/get_estados_ini",
        });
        request.done(function(response) {
            // Agregamos los resultados al select
            jQuery("#id_estado").html(response.estados);
        });                                
    }

    function getEstadoActual() {
        var codigoPostal = jQuery("#codigo_postal").val();
        
        if (!codigoPostal)
            codigoPostal = "0";

        if (codigoPostal!="0") {
            if (codigoPostal.length==5){
                if (codigoPostalTmp != codigoPostal){
                    var request = jQuery.ajax({
                        type: "GET",
                        url: "/ajax/get_clave_estado", 
                        data: {
                            "codigo_postal": codigoPostal,
                        },
                    });

                    request.done(function(response) {
                        // Agregamos los resultados al select
                        var cveEstado = response.clave_estado;
                        var mensaje = response.mensaje;

                        if ((cveEstado) && (cveEstado > 0)){
                            console.log(cveEstado);
                            
                            jQuery("#id_estado option[value='0']").attr("selected",false);

                            jQuery("#id_estado option[value='" + cveEstadoTmp + "']").attr("selected",false);

                            jQuery("#id_estado option[value='" + cveEstado + "']").attr("selected",true);

                            jQuery("#id_estado").trigger("change");
                            jQuery('#id_estado').attr("disabled", true);

                            jQuery("#spanmsg").text("");
                            jQuery("#divmsgerr").attr("style","visibility:hidden");

                            codigoPostalTmp = codigoPostal;
                            cveEstadoTmp = cveEstado;

                        } else {
                            
                            jQuery("#spanmsg").text(mensaje);
                            jQuery("#divmsgerr").attr("style","visibility:visible");

                            jQuery("#id_estado").val('0')
                            jQuery("#id_municipio").val('0')
                            jQuery("#id_colonia").val('0')
                            
                            jQuery('#id_estado').attr("disabled", false);
                            jQuery('#id_municipio').attr("disabled", false);
                            jQuery('#id_colonia').attr("disabled", false);
                            codigoPostalTmp = codigoPostal;
                            
                        }
                    });
                }
            } else {                   
                mensaje = "El código postal debe ser de 5 caracteres. Código postal " + codigoPostal + " inválido"
                jQuery("#spanmsg").text(mensaje);
                jQuery("#divmsgerr").attr("style","visibility:visible");
            }

        } else {
            jQuery("#id_estado option[value=0]").attr("selected",true);
            jQuery('#id_estado').attr("disabled", false);
            jQuery('#id_municipio').attr("disabled", false);

        }
    }

    function getMunicipios() {
        var estadoId = jQuery("#id_estado").val();
        var codigoPostal = jQuery("#codigo_postal").val();

        if (!estadoId)
            estadoId = 0;
        if (!codigoPostal)
            codigoPostal = 0;

        if (estadoId || codigoPostal) {
            // Eliminamos las opciones anteriores del select
            jQuery("#id_municipio").html("");
            var request = jQuery.ajax({
                type: "GET",
                url: "/ajax/get_municipios", 
                data:{
                    'estado_id' : estadoId,
                    'codigo_postal' : codigoPostal,
                }
            });
            request.done(function(response) {
                // Agregamos los resultados al select
                jQuery("#id_municipio").html(response.municipios);
                jQuery("#id_municipio").trigger("change");
                if (codigoPostal>0)
                    jQuery('#id_municipio').attr("disabled", true);
            });
        } else {
            jQuery("#id_municipio").val('0')
            jQuery("#id_colonia").val('0')
        }
    }    

    function getColonias() {
        var estadoId = jQuery("#id_estado").val();
        var municipioId = jQuery("#id_municipio").val();
        var codigoPostal = jQuery("#codigo_postal").val();
        
        if (codigoPostal || (estadoId && municipioId)) {
            // Eliminamos las opciones anteriores del select
            jQuery("#id_colonia").html("");
            var request = jQuery.ajax({
                type: "GET",
                url: "/ajax/get_colonias",
                data:{
                    'estado_id': estadoId,
                    'municipio_id': municipioId,
                    'codigo_postal': codigoPostal,
                }
            });
            request.done(function(response) {
                // Agregamos los resultados al select
                jQuery("#id_colonia").html(response.colonias);
            });
        } else {
            jQuery("#id_colonia").val('0')
        }
    }
</script>
</body>
</html>
